<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xxm.it.business.dao.IGpsInfoDao">
<!-- 查询gps型号信息 -->
	<sql id="query_gpsInfo_sql">
		SELECT
			t.gps_id AS gpsId,
			t.model AS model,
			t.brand AS brand,
			t.manufacturers AS manufacturers,
			t.remark AS remark,
			t.selling_price AS sellingPrice,
			t.costing AS costing,
			t.create_by AS createBy,
			t.create_date AS createDate,
			t.last_update_by AS lastUpdateBy,
			t.last_update_date AS lastUpdateDate,
			t.product_sn AS priductSN,
			t.gps_place_vl AS gpsPlaceVL,
			getBaseDateNameByCode('GPS_POSITION',t.gps_place_vl,1) AS gpsPlaceName,
			
			c.install_id AS "installVO.installId",
			c.product_sn AS "installVO.productSn",
			c.install_by AS "installVO.installBy",
			c.install_date AS "installVO.installDate",
			c.install_site AS "installVO.installSite",
			c.install_carSite AS "installVO.installCarSite",
			c.install_iphone AS "installVO.installIphone",
			c.part_site AS "installVO.partSite",
			l.base_lease_info_id AS "baseLeaseInfoVO.baseLeaseInfoId",
			l.frame_Number AS "baseLeaseInfoVO.frameNumber",
			l.plate_Number AS "baseLeaseInfoVO.plateNumber",
			l.engine_Model AS "baseLeaseInfoVO.engineModel",
			l.engine_Power AS "baseLeaseInfoVO.enginePower",
			l.car_Color AS "baseLeaseInfoVO.carColor",
			s.sp_id as "providerVO.spId",
			s.sp_name as "providerVO.spName",
			p.apply_Info_Id as "applyVO.applyInfoId",
			p.loan_Contract_No as "applyVO.loanContractNo"
		FROM xxm_gps_info_t t
		LEFT JOIN xxm_install_t c ON c.install_id = t.install_id
		LEFT JOIN xxm_lease_info_t l ON l.lease_info_id = t.lease_info_id
		LEFT JOIN xxm_apply_info_t p ON p.apply_Info_Id = l.apply_Info_Id
		LEFT JOIN xxm_service_provider_t s ON s.sp_id = t.sp_id
		WHERE 1 = 1
	</sql>
	<sql id="gpsInfo_select_condition">
		 <if test="gpsPlaceVL != null and gpsPlaceVL != ''">
		 	AND t.gps_place_vl = #{gpsPlaceVL,jdbcType=VARCHAR}
		 </if>
  	 	 <if test="applyVO.loanContractNo != null and applyVO.loanContractNo !=''">
	    	AND a.loan_Contract_No= #{applyVO.loanContractNo,jdbcType=VARCHAR}
	  	 </if>
		 <if test="installVO.installId != null and installVO.installId !=''">
	    	AND c.install_id= #{installVO.installId,jdbcType=VARCHAR}
	  	 </if>
	  	  <if test="baseLeaseInfoVO.baseLeaseInfoId != null and baseLeaseInfoVO.baseLeaseInfoId !=''">
	    	AND l.base_lease_info_id= #{baseLeaseInfoVO.baseLeaseInfoId,jdbcType=VARCHAR}
	  	 </if>
	  	  <if test="gpsId != null and gpsId !=''">
	    	AND t.gps_id= #{gpsId,jdbcType=VARCHAR}
	  	 </if>
	  	 <if test="model != null and model !=''">
	    	AND t.model= #{model,jdbcType=VARCHAR}
	  	 </if>
	  	 	 <if test="startCreateDate != null and startCreateDate !=''">
	    	AND t.create_date <![CDATA[ >= ]]> #{startCreateDate,jdbcType=VARCHAR}
	  	 </if>
	  	 <if test="endCreateDate != null and endCreateDate !=''">
	    	AND t.create_date <![CDATA[ <= ]]> #{endCreateDate,jdbcType=VARCHAR}
	  	 </if>
	  	 <if test="installVO.startInstallDate != null and installVO.startInstallDate != ''">
	  	 	AND c.install_date <![CDATA[ >= ]]> #{installVO.startInstallDate,jdbcType=VARCHAR}
	  	 </if>
	  	 <if test="installVO.endInstallDate != null and installVO.endInstallDate != ''">
	  	 	AND c.install_date <![CDATA[ <= ]]> #{installVO.endInstallDate,jdbcType=VARCHAR}
	  	 </if>
		<if test="installVO.productSn !=null and installVO.productSn !=''">
			AND c.product_sn=#{installVO.productSn,jdbcType=VARCHAR}
		</if>
		<if test="priductSN != null and priductSN != ''">
			AND t.product_sn = #{priductSN,jdbcType=VARCHAR}
		</if>
	</sql>
	 <!-- 查询gps型号列表信息-->
<select id="findGpsInfoList" resultType="com.xxm.it.business.vo.GpsInfoVO" parameterType ="com.xxm.it.business.vo.GpsInfoVO">
		 <include refid="query_gpsInfo_sql"></include>
	  	 <include refid="gpsInfo_select_condition"></include>
		order by t.create_date desc
		limit #{offset,jdbcType=VARCHAR},#{limit,jdbcType=VARCHAR}
</select>

<!-- 查询gps型号列表总数-->
	<select id="findGpsInfoListCount" resultType="java.lang.Integer" parameterType="com.xxm.it.business.vo.GpsInfoVO">
		 SELECT count(gps_id) FROM xxm_gps_info_t t
			LEFT JOIN xxm_install_t c ON c.install_id = t.install_id
			LEFT JOIN xxm_base_lease_info_t l ON l.base_lease_info_id = t.lease_info_id
			LEFT JOIN xxm_lease_info_t e ON e.base_lease_info_id = l.base_lease_info_id
			LEFT JOIN xxm_apply_info_t p ON p.apply_Info_Id = e.apply_Info_Id
			LEFT JOIN xxm_service_provider_t s ON s.sp_id = t.sp_id
			WHERE 1 = 1
		 <include refid="gpsInfo_select_condition"></include>
	</select>
<!-- 添加gps型号信息 -->
	<insert id="addGpsInfo" parameterType="com.xxm.it.business.vo.GpsInfoVO" useGeneratedKeys="true" keyProperty="gpsId">
		INSERT INTO xxm_gps_info_t(
			model,
			brand,
			manufacturers,
			remark,
			selling_price,
			costing,
			gps_place_vl,
			create_by,
			create_date,
			last_update_by,
			last_update_date
		)VALUES(
			#{model,jdbcType=VARCHAR},
			#{brand,jdbcType=VARCHAR},
			#{manufacturers,jdbcType=VARCHAR},
			#{remark,jdbcType=VARCHAR},
			#{sellingPrice,jdbcType=VARCHAR},
			#{costing,jdbcType=VARCHAR},
			#{gpsPlaceVL,jdbcType=VARCHAR},
			#{createBy,jdbcType=VARCHAR},
			sysdate(),
			#{lastUpdateBy,jdbcType=VARCHAR},
			sysdate()
		)
</insert>
	<!-- 查询gps型号信息-->
	<select id="findGpsInfo" resultType="com.xxm.it.business.vo.GpsInfoVO" parameterType="com.xxm.it.business.vo.GpsInfoVO">
		 <include refid="query_gpsInfo_sql"></include>
	  	 <include refid="gpsInfo_select_condition"></include>
	</select>
	
	<!-- 查询gps型号信息(List)-->
	<select id="findGpsInfos" resultType="com.xxm.it.business.vo.GpsInfoVO" parameterType="com.xxm.it.business.vo.GpsInfoVO">
		 <include refid="query_gpsInfo_sql"></include>
	  	 <include refid="gpsInfo_select_condition"></include>
	</select>
<!-- 	修改gps型号信息 -->
	<update id="updateGpsInfo" parameterType="com.xxm.it.business.vo.GpsInfoVO">
		UPDATE xxm_gps_info_t SET
			model = #{model,jdbcType=VARCHAR},
			brand = #{brand,jdbcType=VARCHAR},
			manufacturers = #{manufacturers,jdbcType=VARCHAR},
			remark = #{remark,jdbcType=VARCHAR},
			selling_price = #{sellingPrice,jdbcType=VARCHAR},
			costing = #{costing,jdbcType=VARCHAR},
			last_update_date = sysdate()
		WHERE 
			gps_id = #{gpsId,jdbcType=VARCHAR}
	
	</update>
	
<!-- 	删除gps型号信息 -->
	<delete id="deleteGpsInfo" parameterType="com.xxm.it.business.vo.GpsInfoVO">
		DELETE FROM xxm_gps_info_t

		WHERE gps_id in
		<foreach collection="gpsIds" item="item" index="index"
			separator="," open="(" close=")">
			#{item}
		</foreach>
	</delete>
	<!-- 查询gps型号列表 -->
	<select id="findGpsModelList" resultType="com.xxm.it.business.vo.GpsInfoVO">
		SELECT
			t.gps_id AS gpsId,
			t.model AS model
		FROM
			xxm_gps_info_t t
		GROUP BY
			model
	</select>
	<!-- 添加gps入仓 -->
	<insert id="addEntryGpsInfo" parameterType="com.xxm.it.business.vo.GpsInfoVO" useGeneratedKeys="true" keyProperty="gpsId">
		INSERT INTO xxm_gps_info_t (
			model,
			brand,
			selling_price,
			costing,
			product_sn,
			entry_type,
			entry_man,
			entry_time,
			gps_place_vl,
			create_by,
			create_date,
			last_update_by,
			last_update_date
		)
		VALUES
		(
			#{model,jdbcType=VARCHAR},
			#{brand,jdbcType=VARCHAR},
			#{sellingPrice,jdbcType=VARCHAR},
			#{costing,jdbcType=VARCHAR},
			#{priductSN,jdbcType=VARCHAR},
			#{entryType,jdbcType=VARCHAR},
			#{entryMan,jdbcType=VARCHAR},
			#{entryTime,jdbcType=VARCHAR},
			#{gpsPlaceVL,jdbcType=VARCHAR},
			#{createBy,jdbcType=VARCHAR},
			sysdate(),
			#{lastUpdateBy,jdbcType=VARCHAR},
			sysdate()
		)
	</insert>
	<!-- sp商名称列表 -->
	<select id="findProviderList" resultType="com.xxm.it.business.vo.ProviderVO">
		SELECT
			t.sp_id AS spId,
			t.sp_name AS spName
		FROM
			xxm_service_provider_t t
		GROUP BY
			spName
	</select>
	<!-- gps销售 -->
	<update id="addOutWarehouseInfo" parameterType="com.xxm.it.business.vo.GpsInfoVO">
		UPDATE xxm_gps_info_t
		SET 
			costing = #{costing,jdbcType=VARCHAR},
			gps_place_vl = #{gpsPlaceVL,jdbcType=VARCHAR},
			sp_id = #{spId,jdbcType=VARCHAR},
			out_warehouse_type = #{outWarehouseType,jdbcType=VARCHAR},
			out_warehouse_man = #{outWarehouseMan,jdbcType=VARCHAR},
			out_warehouse_time = #{outWarehouseTime,jdbcType=VARCHAR},
			last_update_by = #{lastUpdateBy,jdbcType=VARCHAR},
			last_update_date = sysdate()
		WHERE
			product_sn = #{priductSN,jdbcType=VARCHAR}
	</update>
	<!--  gps安装（根据申请编号查询车辆信息） -->
	<select id="findLeaseInfo" resultType="com.xxm.it.business.vo.GpsInfoVO" parameterType="com.xxm.it.business.vo.GpsInfoVO">
		SELECT 
			l.lease_info_id AS "baseLeaseInfoVO.leaseInfoId",
			l.plate_Number AS "baseLeaseInfoVO.plateNumber",
			l.frame_Number AS "baseLeaseInfoVO.frameNumber",
			l.engine_Model AS "baseLeaseInfoVO.engineModel",
			l.engine_Power AS "baseLeaseInfoVO.enginePower",
			l.car_Color AS "baseLeaseInfoVO.carColor",
			l.brand AS "baseLeaseInfoVO.brand",
			l.manufacturer AS "baseLeaseInfoVO.manufacturer"
		FROM xxm_apply_info_t t
		LEFT JOIN xxm_lease_info_t l ON l.apply_Info_Id = t.apply_Info_Id
		WHERE 
			t.loan_Contract_No = #{applyVO.loanContractNo,jdbcType=VARCHAR}
	</select>
	<!-- 添加安装gps信息 -->
	<insert id="addInstall" parameterType="com.xxm.it.business.vo.InstallVO" useGeneratedKeys="true" keyProperty="installId">
		INSERT INTO xxm_install_t (
			product_sn,
			install_by,
			install_date,
			install_carSite,
			install_site,
			install_iphone,
			create_by,
			create_date,
			last_update_by,
			last_update_date
		)
		VALUES
		(
			#{productSn,jdbcType=VARCHAR},
			#{installBy,jdbcType=VARCHAR},
			#{installDate,jdbcType=VARCHAR},
			#{installCarSite,jdbcType=VARCHAR},
			#{installSite,jdbcType=VARCHAR},
			#{installIphone,jdbcType=VARCHAR},
			#{createBy,jdbcType=VARCHAR},
			sysdate(),
			#{lastUpdateBy,jdbcType=VARCHAR},
			sysdate()
		)
	</insert>
	<update id="updateGpsInfoVO" parameterType="com.xxm.it.business.vo.GpsInfoVO">
		UPDATE xxm_gps_info_t
		SET install_id = #{installVO.installId,jdbcType=VARCHAR},
			lease_info_id = #{baseLeaseInfoVO.leaseInfoId,jdbcType=VARCHAR},
			gps_place_vl = #{gpsPlaceVL,jdbcType=VARCHAR},
			last_update_by = #{lastUpdateBy,jdbcType=VARCHAR},
			last_update_date = sysdate()
		WHERE
			product_sn = #{priductSN,jdbcType=VARCHAR}
	</update>
</mapper>