<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xxm.it.business.dao.IActIdGroupDao">
	<!-- 查询语句 -->
	<sql id="query_actIdGroup_sql">
		SELECT
			t.ID_ as actIdGroupID,
			t.REV_ as actIdGroupREV,
			t.NAME_ as actIdGroupNAME,
			t.TYPE_ as actIdGroupTYPE
		FROM act_id_group t
			WHERE 1=1 
	</sql>
	
	<!-- 查询条件 -->
	<sql id="actIdGroup_query_condition">
		<if test="actIdGroupID != null and actIdGroupID !=''">
			AND	t.ID_ =#{actIdGroupID,jdbcType=VARCHAR}
		</if>
		<if test="actIdGroupREV != null and actIdGroupREV !=''">
			AND t.REV_ =#{actIdGroupREV,jdbcType=VARCHAR}
		</if>
		<if test="actIdGroupNAME != null and actIdGroupNAME !=''">
			AND t.NAME_ =#{actIdGroupNAME,jdbcType=VARCHAR}
		</if>
		<if test="actIdGroupTYPE != null and actIdGroupTYPE !=''">
			AND t.TYPE_ =#{actIdGroupTYPE,jdbcType=VARCHAR}
		</if>
	</sql>
	
	<!-- 查询列表信息 -->
	<select id="findActIdGroupList" resultType="com.xxm.it.business.vo.ActIdGroupVO" parameterType ="com.xxm.it.business.vo.ActIdGroupVO">
		 <include refid="query_actIdGroup_sql"></include>
	  	 <include refid="actIdGroup_query_condition"></include>
			<!-- order by t.create_date desc -->
			limit #{offset,jdbcType=VARCHAR},#{limit,jdbcType=VARCHAR}
	</select>
	
	<!-- 查询列表总数 -->
	<select id="findActIdGroupListCount" resultType="java.lang.Integer" parameterType ="com.xxm.it.business.vo.ActIdGroupVO">
 		 SELECT count(t.ID_)FROM act_id_group t WHERE 1=1 
	  	 <include refid="actIdGroup_query_condition"></include>
	</select>
	
	<!-- 添加数据 -->
	<insert id="addActIdGroup">
		INSERT INTO act_id_group(
			ID_ ,
			REV_,
			NAME_ ,
			TYPE_ 
		)VALUES(
			#{actIdGroupID,jdbcType=VARCHAR},
			1,
			#{actIdGroupNAME,jdbcType=VARCHAR},
			#{actIdGroupTYPE,jdbcType=VARCHAR}
		)
	</insert>
	
	<!-- 查询数据 -->
	<select id="findActIdGroup" resultType="com.xxm.it.business.vo.ActIdGroupVO" parameterType ="com.xxm.it.business.vo.ActIdGroupVO">
		 <include refid="query_actIdGroup_sql"></include>
	  	 <include refid="actIdGroup_query_condition"></include>
	</select>
	<select id="findActIdGroups" resultType="com.xxm.it.business.vo.ActIdGroupVO" parameterType ="com.xxm.it.business.vo.ActIdGroupVO">
		 <include refid="query_actIdGroup_sql"></include>
	  	 <include refid="actIdGroup_query_condition"></include>
	</select>
	
	<!-- 修改数据 -->
	<update id="updateActIdGroup" parameterType ="com.xxm.it.business.vo.ActIdGroupVO">
		UPDATE act_id_group SET 
			NAME_ = #{actIdGroupNAME,jdbcType=VARCHAR},
			TYPE_ = #{actIdGroupTYPE,jdbcType=VARCHAR}
		WHERE 
			ID_ = #{actIdGroupID,jdbcType=VARCHAR}
	</update>
	
	<!-- 删除数据 -->
	<delete id="deleteActIdGroup" parameterType ="com.xxm.it.business.vo.ActIdGroupVO"> 
			DELETE FROM act_id_group
			WHERE ID_ in
		<foreach collection="actIdGroupIDs" item="item" index="index"
			separator="," open="(" close=")">
			#{item}
		</foreach>
	</delete>
	<!-- 查询数据 -->
	<select id="findGroupUserList" resultType="com.xxm.it.system.vo.UserVO" parameterType="com.xxm.it.business.vo.ActIdGroupVO">
		SELECT
			u.user_id as userId,
			u.name as name,
			u.phone AS phone,
			u.employee_No AS employeeNo
		FROM  act_id_membership m
		inner JOIN xxm_user_t u ON u.user_id = m.USER_ID_ 
		WHERE m.group_id_ = #{actIdGroupID,jdbcType=VARCHAR}
	</select>
	<!-- 删除membership表数据 -->
	<delete id="deleteMembership" parameterType="com.xxm.it.business.vo.ActIdGroupVO">
		DELETE FROM act_id_membership
			WHERE GROUP_ID_ =#{actIdGroupID,jdbcType=VARCHAR}
	</delete>
	<!-- 增加membership表数据 -->
	<insert id="addMembership" parameterType="com.xxm.it.business.vo.ActIdGroupVO">
		INSERT INTO act_id_membership(
			USER_ID_ ,
			GROUP_ID_
		)VALUES(
			#{userId,jdbcType=VARCHAR},
			#{actIdGroupID,jdbcType=VARCHAR}
		)
	</insert>
</mapper>