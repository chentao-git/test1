<!DOCTYPE html>
<html lang="en">
<!-- Mirrored from www.zi-han.net/theme/hplus/login.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Jan 2016 14:18:23 GMT -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鑫小马登录页面</title>
    <meta name="keywords" content="鑫小马登录页面">
    <meta name="description" content="鑫小马登录页面">
    <link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
    <link href="css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
    <link href="css/animate.min.css" rel="stylesheet">
    <link href="css/style.min862f.css?v=4.1.0" rel="stylesheet">
	<!--<link href="../css/login.min.css" rel="stylesheet"> -->
    <!--[if lt IE 9]>
    <meta http-equiv="refresh" content="0;ie.html" />
    <![endif]-->
    <script>if(window.top !== window.self){ window.top.location = window.location;}</script>
</head>
<style>
	body{
		height:auto;
		background:url(img/login2.jpg) no-repeat center fixed;
		-webkit-background-size:cover;
		-moz-background-size:cover;
		-o-background-size:cover;
		background-size:cover;
/* 		color:rgba(255,255,255,.95) */
	}
</style>
<body>

    <div class="middle-box text-center loginscreen  animated fadeInDown">
        <div>
            <div>

                <h1 class="logo-name"><span class="glyphicon glyphicon-send" aria-hidden="true"></span></h1>

            </div>
            <h3>HI 欢迎来到鑫小马</h3>
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="帐号" id="account" name="account">
                </div>
                <div class="form-group">
                    <input type="password" class="form-control" placeholder="密码" id="password" name="password">
                </div>
                <div class="form-group" style="display:none;" id="vtion">
                    <input type="text" class="form-control col-sm-4" placeholder="验证码" id="verification" name="verification" style="width: 140px;" maxlength="6">
               		<canvas id="canvas"  style="width: 160px;height:43px;" class="col-sm-8"></canvas>
                </div>
                <button onclick="$.loginFu()" class="btn btn-primary block full-width m-b" id ="btn">登 录</button>
                <p class="text-muted text-center">
                	<a href="#" id="promptA"></a>
                </p>
        </div>
    </div>
    <script src="js/jquery.min.js?v=2.1.4"></script>
    <script src="js/bootstrap.min.js?v=3.3.6"></script>
    <script type="text/javascript" src="http://tajs.qq.com/stats?sId=9051096" charset="UTF-8"></script>
	<script src="js/plugins/validate/jquery.validate.min.js"></script>
	<script>
    $(function() {
    	var counts=0;
    	//回车提交事件
    	$("body").keydown(function() {
    		if (event.keyCode == "13") {//keyCode=13是回车键
    			$.loginFu();
    		}
    	});
    	var showNum =[];
    	draw(showNum);
    	$("#canvas").on('click',function(){
    		draw(showNum);
    	});
    	function draw(showNum){
    		var canvas_width=$('#canvas').width();
    		var canvas_height=$('#canvas').height();
    		var canvas = document.getElementById("canvas");//获取到canvas的对象，演员
    		var context = canvas.getContext("2d");//获取到canvas画图的环境，演员表演的舞台
    		canvas.width = canvas_width;
    		canvas.height = canvas_height;
    		var sCode = "A,B,C,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,W,X,Y,Z,1,2,3,4,5,6,7,8,9,0";
    		var aCode = sCode.split(",");
    		var aLength = aCode.length;//获取到数组的长度
    	for(var i=0;i<=5;i++){
    		var j = Math.floor(Math.random() * aLength);//获取到随机的索引值
			var deg = Math.random() * 30 * Math.PI / 180;//产生0~30之间的随机弧度
			var txt = aCode[j];//得到随机的一个内容
			showNum[i] = txt.toLowerCase();
			var x = 10 + i * 20;//文字在canvas上的x坐标
			var y = 20 + Math.random() * 8;//文字在canvas上的y坐标
			context.font = "bold 23px 微软雅黑";

			context.translate(x, y);
			context.rotate(deg);

			context.fillStyle = randomColor();
			context.fillText(txt, 0, 0);

			context.rotate(-deg);
			context.translate(-x, -y);
    	}for (var i = 0; i <= 5; i++) { //验证码上显示线条
    		context.strokeStyle = randomColor();
    		context.beginPath();
    		context.moveTo(Math.random() * canvas_width, Math.random() * canvas_height);
    		context.lineTo(Math.random() * canvas_width, Math.random() * canvas_height);
    		context.stroke();
    	}
    	for (var i = 0; i <= 30; i++) { //验证码上显示小点
    		context.strokeStyle = randomColor();
    		context.beginPath();
    		var x = Math.random() * canvas_width;
    		var y = Math.random() * canvas_height;
    		context.moveTo(x, y);
    		context.lineTo(x + 1, y + 1);
    		context.stroke();
    	}
    	function randomColor() {//得到随机的颜色值
    		var r = Math.floor(Math.random() * 256);
    		var g = Math.floor(Math.random() * 256);
    		var b = Math.floor(Math.random() * 256);
    		return "rgb(" + r + "," + g + "," + b + ")";
    	}
    	}
    	
    	
        $.loginFu=function(){
        		var acc = $("#verification").val()
        		var abb = "";
        		for(var i =0;i<showNum.length;i++){
        			abb+=showNum[i];
        		}
        	if (!$("#account").val()) {
        		$("#promptA").html('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>帐号不能为空！');
        		$("#promptA").css("color","red");
        		
    			return;
    		}
    		if (!$("#password").val()) {
	    			$("#promptA").html('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>密码不能为空！');
	        		$("#promptA").css("color","red");
	    			return;
	    			
    		}
    		
    		if(counts>=2){
    				$("#vtion").show();
    				if(counts>=3){
    			if (!$("#verification").val()) {
	    			$("#promptA").html('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>验证码不能为空！');
	        		$("#promptA").css("color","red");
	        		draw(showNum);
    				return;
    			}
    			if(acc != abb){
	    			$("#promptA").html('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>验证码错误!');
	        		$("#promptA").css("color","red");
	        		draw(showNum);
	    			return;
    							}	
    				}
    		}
    		var data={};
    		data.account=$("#account").val();
    		data.password=$("#password").val();
    		//登录
    		$.ajax({url:'/xxm/rest/user/userService/login',
    			data:JSON.stringify(data),
    			type:'post',  
    			cache:false,  
    			async: false,
    			dataType:'json',  
    			contentType: "application/json",
    			success:function(result) {
    				if (result.result) {
    					//存储用户对象
    					if (window.sessionStorage) {
    						sessionStorage.setItem("userInfo", JSON.stringify(result.userVO));
    					}
    					//跳转页面
    					window.location.href="index.html";
    				}else{
    					$("#promptA").html(result.msg);
    	        		$("#promptA").css("color","red");
    	        		counts++;
    				}
    			},
    			error : function() {  
    				$("#promptA").html("系统出现异常，请联系管理员！");
	        		$("#promptA").css("color","red");
    			}  
    		});
        }
        
    });
    </script>
</body>


<!-- Mirrored from www.zi-han.net/theme/hplus/login.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Jan 2016 14:18:23 GMT -->
</html>
